Bootstrap: docker
From: continuumio/miniconda3:4.4.10

%labels
AUTHOR ankita.nand@uhnresearch.ca

%environment
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# This sets global environment variables for anything run within the container
export PATH="/opt/conda/bin:/usr/local/bin:/usr/bin:/bin:"
unset CONDA_DEFAULT_ENV
export ANACONDA_HOME=/opt/conda

%post
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# This is going to be executed after the base container has been downloaded
export PATH=/opt/conda/bin:$PATH
conda config --add channels defaults
conda config --add channels conda-forge
conda config --add channels bioconda
#conda install --yes bwa=0.7.15
conda install --yes samtools=1.8

conda install --yes sambamba samtools
conda install --yes trim-galore fastqc
conda install --yes bowtie2
conda install --yes python>=3.6
conda install --yes pandas scipy snakemake-minimal
conda install --yes pysam
conda install --yes bedtools pybedtools
conda install --yes r-dunn.test
conda install --yes macs2>=2.2.4
conda install --yes -c r r

# bioconductor
conda install --yes bioconductor-edger bioconductor-diffbind bioconductor-deseq2

# R libraries
R -e "install.packages('optparse', repos='http://cran.rstudio.com')"
R -e "install.packages('reticulate', repos='http://cran.rstudio.com')"
R -e "install.packages('caTools', repos='http://cran.rstudio.com')"
R -e "install.packages('BiocManager', repos='http://cran.rstudio.com')"
R -e "BiocManager::install('TxDb.Hsapiens.UCSC.hg38.knownGene')"
R -e "BiocManager::install('org.Hs.eg.db')"
R -e "BiocManager::install('ChIPseeker')"
R -e "BiocManager::install('ChIPpeakAnno')"
R -e "BiocManager::install('survcomp')"


conda clean --index-cache --tarballs --packages --yes